<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <?include $(sys.CURRENTDIR)\Common.wxi?>

  <?define LightSwitchFiles=PowerToys.LightSwitchService.exePowerToys.LightSwitchService.exePowerToys.LightSwitchService.exe?>
  <?define LightSwitchFilesPath=$(var.BinDir)\LightSwitchService\?>

  <Fragment>
    <!-- Light Switch background service -->

    <!-- Create a directory for the service binaries -->
    <DirectoryRef Id="BaseApplicationsFolder">
      <Directory Id="LightSwitchServiceFolder" Name="LightSwitchService" />
    </DirectoryRef>

    <!-- File components generated by generateAllFileComponents.ps1 -->
    <DirectoryRef Id="LightSwitchServiceFolder" FileSource="$(var.LightSwitchFilesPath)">

            <Component Id="LightSwitchFiles_Component" Guid="70654D33-B978-4ABE-B95D-DFBD77B08233">
              <RegistryKey Root="HKLM" Key="Software\Classes\powertoys\components">
                <RegistryValue Type="string" Name="LightSwitchFiles_Component" Value="" KeyPath="yes"/>
              </RegistryKey>
              <File Id="LightSwitchFiles_File_PowerToys.LightSwitchService.exe" Source="$(var.LightSwitchFilesPath)\PowerToys.LightSwitchService.exe" />
            </Component>

    </DirectoryRef>

    <!-- Group to include the service + cleanup on uninstall -->
    <ComponentGroup Id="LightSwitchComponentGroup">

      <!-- Ensures folder removal on uninstall -->
      <Component Id="RemoveLightSwitchServiceFolder" Guid="C1E2F2ED-34A2-4EB0-8E17-DC0535F50F9D" Directory="INSTALLFOLDER">
        <RegistryKey Root="$(var.RegistryScope)" Key="Software\Classes\powertoys\components">
          <RegistryValue Type="string" Name="RemoveLightSwitchServiceFolder" Value="" KeyPath="yes" />
        </RegistryKey>
        <RemoveFolder Id="RemoveFolderLightSwitchServiceFolder" Directory="LightSwitchServiceFolder" On="uninstall" />
      </Component>

            <ComponentRef Id="LightSwitchFiles_Component" />
            <ComponentRef Id="LightSwitchFiles_Component" />
            <ComponentRef Id="LightSwitchFiles_Component" />
    </ComponentGroup>

  </Fragment>
</Wix>
