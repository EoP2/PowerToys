<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="PowerDisplay.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:PowerDisplay.ViewModels"
        xmlns:converters="using:PowerDisplay.Converters"
        xmlns:toolkit="using:CommunityToolkit.WinUI.Controls"
        xmlns:ui="using:CommunityToolkit.WinUI"
        xmlns:animations="using:CommunityToolkit.WinUI.Animations">
    <Grid x:Name="RootGrid" Style="{StaticResource WindowBackgroundStyle}">
        <Grid.RenderTransform>
            <TranslateTransform x:Name="RootGridTransform" X="0" />
        </Grid.RenderTransform>

        <Grid.Resources>
            <!-- Enhanced Slide-in animation storyboard -->
            <Storyboard x:Key="SlideInStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGridTransform"
                               Storyboard.TargetProperty="X"
                               From="300"
                               To="0"
                               Duration="0:0:0.4">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="RootGrid"
                               Storyboard.TargetProperty="Opacity"
                               From="0"
                               To="1"
                               Duration="0:0:0.3" />
                <DoubleAnimation Storyboard.TargetName="MainContainer"
                               Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.Y)"
                               From="20"
                               To="0"
                               Duration="0:0:0.5">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseOut" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
            </Storyboard>

            <!-- Enhanced Slide-out animation storyboard -->
            <Storyboard x:Key="SlideOutStoryboard">
                <DoubleAnimation Storyboard.TargetName="RootGridTransform"
                               Storyboard.TargetProperty="X"
                               From="0"
                               To="300"
                               Duration="0:0:0.3">
                    <DoubleAnimation.EasingFunction>
                        <CubicEase EasingMode="EaseIn" />
                    </DoubleAnimation.EasingFunction>
                </DoubleAnimation>
                <DoubleAnimation Storyboard.TargetName="RootGrid"
                               Storyboard.TargetProperty="Opacity"
                               From="1"
                               To="0"
                               Duration="0:0:0.2" />
            </Storyboard>
        </Grid.Resources>

        <!-- Main Container with modern design -->
        <Border x:Name="MainContainer"
                CornerRadius="{StaticResource OverlayCornerRadius}"
                Background="{ThemeResource LayerFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                Margin="0"
                MaxWidth="640"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Top">
            <Border.RenderTransform>
                <TranslateTransform Y="0" />
            </Border.RenderTransform>

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Content Area -->
                <ScrollViewer Grid.Row="0"
                             ZoomMode="Disabled"
                             HorizontalScrollMode="Disabled"
                             HorizontalScrollBarVisibility="Disabled"
                             VerticalScrollBarVisibility="Auto"
                             MaxHeight="420"
                             Padding="8">

                    <StackPanel Spacing="{StaticResource SmallSpacing}">

                        <!-- Loading State with modern progress -->
                        <StackPanel Orientation="Vertical"
                                   Spacing="{StaticResource LargeSpacing}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="{Binding IsScanning, Converter={StaticResource BoolToVisibilityConverter}}">
                            <ProgressRing IsActive="True"
                                         Width="32"
                                         Height="32"
                                         Foreground="{ThemeResource AccentFillColorDefaultBrush}" />
                            <TextBlock x:Name="ScanningMonitorsTextBlock"
                                      Style="{StaticResource ControlLabelStyle}"
                                      HorizontalAlignment="Center"
                                      TextAlignment="Center" />
                        </StackPanel>

                        <!-- No Monitors State with InfoBar -->
                        <InfoBar x:Name="NoMonitorsInfoBar"
                                        IsOpen="{Binding ShowNoMonitorsMessage}"
                                        Severity="Informational"
                                        IsClosable="False"
                                        Background="{ThemeResource InfoBarInformationalSeverityBackgroundBrush}">
                            <InfoBar.IconSource>
                                <FontIconSource Glyph="&#xE7F4;" />
                            </InfoBar.IconSource>
                            <TextBlock x:Name="NoMonitorsTextBlock" />
                        </InfoBar>

                        <!-- Monitors List with modern card design -->
                        <ItemsControl ItemsSource="{Binding Monitors}"
                                     Visibility="{Binding HasMonitors, Converter={StaticResource BoolToVisibilityConverter}}"
                                     HorizontalAlignment="Stretch">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Vertical"
                                               Spacing="0">
                                        <StackPanel.ChildrenTransitions>
                                            <TransitionCollection>
                                                <EntranceThemeTransition FromVerticalOffset="20" />
                                                <RepositionThemeTransition IsStaggeringEnabled="True" />
                                            </TransitionCollection>
                                        </StackPanel.ChildrenTransitions>
                                    </StackPanel>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:MainViewModel+MonitorViewModel">
                                    <StackPanel Spacing="2" HorizontalAlignment="Stretch">
                                        <StackPanel.ChildrenTransitions>
                                            <TransitionCollection>
                                                <EntranceThemeTransition FromVerticalOffset="8" />
                                                <RepositionThemeTransition />
                                            </TransitionCollection>
                                        </StackPanel.ChildrenTransitions>

                                        <!-- Monitor Name -->
                                        <TextBlock Text="{Binding Name}"
                                                  Style="{StaticResource MonitorTitleTextStyle}"
                                                  Padding="8,4" />

                                                    <!-- Brightness Control -->
                                                    <Grid Height="40" HorizontalAlignment="Stretch">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE793;"
                                                                 Style="{StaticResource CompactIconStyle}" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               Style="{StaticResource CompactSliderStyle}"
                                                               Minimum="{Binding MinBrightness}"
                                                               Maximum="{Binding MaxBrightness}"
                                                               Value="{Binding Brightness, Mode=TwoWay}"
                                                               IsEnabled="{Binding IsAvailable}" />

                                                        <TextBlock Grid.Column="2"
                                                                  Style="{StaticResource CompactValueTextStyle}"
                                                                  Text="{Binding Brightness, Mode=OneWay}" />
                                                    </Grid>

                                                    <!-- Color Temperature Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{Binding ShowColorTemperature, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE790;"
                                                                 Style="{StaticResource CompactIconStyle}" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               Style="{StaticResource CompactSliderStyle}"
                                                               Minimum="0"
                                                               Maximum="100"
                                                               Value="{Binding ColorTemperaturePercent, Mode=TwoWay}"
                                                               IsEnabled="{Binding IsAvailable}" />

                                                        <TextBlock Grid.Column="2"
                                                                  Style="{StaticResource CompactValueTextStyle}">
                                                            <Run Text="{Binding ColorTemperature}" />
                                                            <Run Text="K" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                                    <!-- Contrast Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{Binding ShowContrast, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE7A6;"
                                                                 Style="{StaticResource CompactIconStyle}" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               Style="{StaticResource CompactSliderStyle}"
                                                               Minimum="0"
                                                               Maximum="100"
                                                               Value="{Binding ContrastPercent, Mode=TwoWay}"
                                                               IsEnabled="{Binding IsAvailable}" />

                                                        <TextBlock Grid.Column="2"
                                                                  Style="{StaticResource CompactValueTextStyle}">
                                                            <Run Text="{Binding Contrast}" />
                                                            <Run Text="%" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                                    <!-- Volume Control -->
                                                    <Grid Height="40"
                                                          HorizontalAlignment="Stretch"
                                                          Visibility="{Binding ShowVolume, Converter={StaticResource BoolToVisibilityConverter}}">
                                                        <Grid.Transitions>
                                                            <TransitionCollection>
                                                                <EntranceThemeTransition FromVerticalOffset="10" />
                                                                <RepositionThemeTransition />
                                                            </TransitionCollection>
                                                        </Grid.Transitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="1*"/>
                                                            <ColumnDefinition Width="7*"/>
                                                            <ColumnDefinition Width="2*"/>
                                                        </Grid.ColumnDefinitions>

                                                        <FontIcon Grid.Column="0"
                                                                 Glyph="&#xE767;"
                                                                 Style="{StaticResource CompactIconStyle}" />

                                                        <Slider Grid.Column="1"
                                                               HorizontalAlignment="Stretch"
                                                               Style="{StaticResource CompactSliderStyle}"
                                                               Minimum="{Binding MinVolume}"
                                                               Maximum="{Binding MaxVolume}"
                                                               Value="{Binding Volume, Mode=TwoWay}"
                                                               IsEnabled="{Binding IsAvailable}" />

                                                        <TextBlock Grid.Column="2"
                                                                  Style="{StaticResource CompactValueTextStyle}">
                                                            <Run Text="{Binding Volume}" />
                                                            <Run Text="%" FontSize="9" />
                                                        </TextBlock>
                                                    </Grid>

                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>

                <!-- Status Bar with modern design -->
                <Grid Grid.Row="1" Style="{StaticResource StatusBarStyle}">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Status Information -->
                    <StackPanel Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock x:Name="AdjustBrightnessTextBlock"
                                  Style="{StaticResource MonitorTitleTextStyle}" />
                        <TextBlock Text="{Binding StatusText}"
                                  Style="{StaticResource ControlLabelStyle}" />
                    </StackPanel>

                    <!-- Action Buttons -->
                    <StackPanel Grid.Column="1"
                               Orientation="Horizontal"
                               Spacing="{StaticResource SmallSpacing}"
                               VerticalAlignment="Center">
                        <Button x:Name="LinkButton"
                               Style="{StaticResource MonitorActionButtonStyle}"
                               ToolTipService.ToolTip="Sync all monitors">
                            <FontIcon Glyph="&#xE71B;" FontSize="16" />
                        </Button>
                        <Button x:Name="DisableButton"
                               Style="{StaticResource MonitorActionButtonStyle}"
                               ToolTipService.ToolTip="Toggle control">
                            <FontIcon Glyph="&#xE7E8;" FontSize="16" />
                        </Button>
                        <Button x:Name="ThemeButton"
                               Style="{StaticResource MonitorActionButtonStyle}"
                               ToolTipService.ToolTip="Switch theme">
                            <FontIcon x:Name="ThemeIcon"
                                     Glyph="&#xE706;"
                                     FontSize="16" />
                        </Button>
                        <Button x:Name="RefreshButton"
                               Style="{StaticResource MonitorActionButtonStyle}"
                               ToolTipService.ToolTip="Refresh monitors">
                            <FontIcon Glyph="&#xE72C;" FontSize="16" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>