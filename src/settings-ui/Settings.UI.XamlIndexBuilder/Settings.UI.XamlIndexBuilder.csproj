<Project Sdk="Microsoft.NET.Sdk">
	<Import Project="..\..\Common.Dotnet.CsWinRT.props" />
	<Import Project="..\..\Common.SelfContained.props" />

	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<RootNamespace>Microsoft.PowerToys.Settings.UI.XamlIndexBuilder</RootNamespace>
		<AssemblyName>XamlIndexBuilder</AssemblyName>
		<OutputType>Exe</OutputType>
	</PropertyGroup>

	<ItemGroup>
		<PackageReference Include="System.Text.Json" />
		<PackageReference Include="System.CommandLine" />
	</ItemGroup>

	<ItemGroup>
		<ProjectReference Include="..\Settings.UI.Library\Settings.UI.Library.csproj" />
	</ItemGroup>

	<PropertyGroup>
		<XamlViewsDir Condition="'$(XamlViewsDir)' == ''">$(MSBuildProjectDirectory)\..\Settings.UI\SettingsXAML\Views</XamlViewsDir>
		<GeneratedJsonFile Condition="'$(GeneratedJsonFile)' == ''">$(MSBuildProjectDirectory)\..\Settings.UI\Assets\Settings\search.index.json</GeneratedJsonFile>
	</PropertyGroup>

    <Target Name="GenerateSearchIndexSelf" AfterTargets="Build">
        <PropertyGroup>
            <_ToolCommand>&quot;$(TargetDir)$(AssemblyName).exe&quot;</_ToolCommand>
        </PropertyGroup>
        <MakeDir Directories="$([System.IO.Path]::GetDirectoryName('$(GeneratedJsonFile)'))" />
        <Message Importance="high" Text="[XamlIndexBuilder] Generating search index. Views='$(XamlViewsDir)'; Out='$(GeneratedJsonFile)'; Tool='$(_ToolCommand)'." />
        <Exec Command="$(_ToolCommand) &quot;$(XamlViewsDir)&quot; &quot;$(GeneratedJsonFile)&quot;" />
    </Target>
</Project>
