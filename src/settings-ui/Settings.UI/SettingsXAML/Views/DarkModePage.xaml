<?xml version="1.0" encoding="utf-8" ?>
<Page
    x:Class="Microsoft.PowerToys.Settings.UI.Views.DarkModePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ViewModel="using:Microsoft.PowerToys.Settings.UI.ViewModels"
    xmlns:controls="using:Microsoft.PowerToys.Settings.UI.Controls"
    xmlns:converters="using:Microsoft.PowerToys.Settings.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tkcontrols="using:CommunityToolkit.WinUI.Controls"
    xmlns:tkconverters="using:CommunityToolkit.WinUI.Converters"
    xmlns:ui="using:CommunityToolkit.WinUI"
    d:DataContext="{d:DesignInstance Type=ViewModel:DarkModeViewModel}"
    AutomationProperties.LandmarkType="Main"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter" />
    </Page.Resources>

    <controls:SettingsPageControl
        x:Uid="DarkMode"
        IsTabStop="False"
        ModuleImageSource="ms-appx:///Assets/Settings/Modules/Awake.png">
        <controls:SettingsPageControl.ModuleContent>
            <StackPanel Orientation="Vertical">
                <tkcontrols:SettingsCard
                    Header="Enable DarkMode"
                    HeaderIcon="{ui:BitmapIcon Source=/Assets/Settings/Icons/Awake.png}"
                    IsEnabled="{x:Bind ViewModel.IsEnabledGpoConfigured, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
                    <ToggleSwitch IsOn="{x:Bind ViewModel.IsEnabled, Mode=TwoWay}" />
                </tkcontrols:SettingsCard>

                <InfoBar
                    x:Uid="GPO_SettingIsManaged"
                    IsClosable="False"
                    IsOpen="{x:Bind ViewModel.IsEnabledGpoConfigured, Mode=OneWay}"
                    IsTabStop="{x:Bind ViewModel.IsEnabledGpoConfigured, Mode=OneWay}"
                    Severity="Informational" />

                <controls:SettingsGroup Header="Activation" IsEnabled="{x:Bind ViewModel.IsEnabled, Mode=OneWay}">

                    <!--<tkcontrols:SettingsCard x:Uid="DarkMode_ForceLightMode_Shortcut" HeaderIcon="{ui:FontIcon Glyph=&#xE706;}">
                        <controls:ShortcutControl
                            MinWidth="{StaticResource SettingActionControlMinWidth}"
                            AllowDisable="True"
                            HotkeySettings="{x:Bind Path=ViewModel.ForceLightModeActivationShortcut, Mode=TwoWay}" />
                    </tkcontrols:SettingsCard>-->
                    <tkcontrols:SettingsCard x:Uid="DarkMode_ForceDarkMode_Shortcut" HeaderIcon="{ui:FontIcon Glyph=&#xE708;}">
                        <controls:ShortcutControl
                            MinWidth="{StaticResource SettingActionControlMinWidth}"
                            AllowDisable="True"
                            HotkeySettings="{x:Bind Path=ViewModel.ForceDarkModeActivationShortcut, Mode=TwoWay}" />
                    </tkcontrols:SettingsCard>
                </controls:SettingsGroup>

                <controls:SettingsGroup x:Uid="DarkMode_BehaviorSettingsGroup" IsEnabled="{x:Bind ViewModel.IsEnabled, Mode=OneWay}">
                    <tkcontrols:SettingsExpander
                        Description="Determine when dark mode should be turned on"
                        Header="Schedule dark mode"
                        HeaderIcon="{ui:FontIcon Glyph=&#xE823;}"
                        IsExpanded="True">
                        <ComboBox
                            SelectedValue="{x:Bind ViewModel.ScheduleMode, Mode=TwoWay}"
                            SelectedValuePath="Tag"
                            SelectionChanged="ScheduleMode_SelectionChanged">
                            <ComboBoxItem Content="Set hours" Tag="FixedHours" />
                            <ComboBoxItem Content="Sunset to sunrise (Geolocation)" Tag="SunsetToSunriseGeo" />
                            <ComboBoxItem Content="Sunset to sunrise (User selected)" Tag="SunsetToSunriseUser" />
                        </ComboBox>

                        <tkcontrols:SettingsExpander.Items>
                            <tkcontrols:SettingsCard HorizontalContentAlignment="Stretch" ContentAlignment="Vertical">
                                <controls:Timeline
                                    Margin="0,48,0,48"
                                    EndTime="{x:Bind ViewModel.DarkTimeTimeSpan, Mode=OneWay}"
                                    StartTime="{x:Bind ViewModel.LightTimeTimeSpan, Mode=OneWay}"
                                    Sunrise="07:00"
                                    Sunset="21:00" />
                            </tkcontrols:SettingsCard>

                            <!--  Only show time pickers if FixedHours  -->
                            <tkcontrols:SettingsCard Header="Turn on darkmode" Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=FixedHours}">

                                <TimePicker ClockIdentifier="24HourClock" Time="{x:Bind ViewModel.LightTimeTimeSpan, Mode=TwoWay}" />

                            </tkcontrols:SettingsCard>

                            <tkcontrols:SettingsCard Header="Turn off darkmode" Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=FixedHours}">
                                <TimePicker ClockIdentifier="24HourClock" Time="{x:Bind ViewModel.DarkTimeTimeSpan, Mode=TwoWay}" />
                            </tkcontrols:SettingsCard>

                            <!--  Only show location and offset if SunsetToSunriseGeo  -->
                            <tkcontrols:SettingsCard
                                Description="Use your location to calculate sunset and sunrise times"
                                Header="Location"
                                Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=SunsetToSunriseGeo}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <controls:IsEnabledTextBlock
                                        x:Name="SunTimes"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="Please Sync to update Sunrise/Sunset times" />
                                    <Button
                                        x:Name="SyncButton"
                                        HorizontalAlignment="Right"
                                        Click="GetLocation_Click">
                                        <StackPanel Orientation="Horizontal" Spacing="8">
                                            <ProgressRing
                                                x:Name="SyncLoader"
                                                Width="16"
                                                Height="16"
                                                IsActive="False"
                                                Visibility="Collapsed" />
                                            <TextBlock Text="Sync" />
                                        </StackPanel>
                                    </Button>
                                </StackPanel>
                            </tkcontrols:SettingsCard>

                            <tkcontrols:SettingsCard Header="Apply an offset in minutes" Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=SunsetToSunriseGeo}">
                                <Grid VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Slider
                                        x:Name="geoOffsetSlider"
                                        Grid.Column="0"
                                        Maximum="60"
                                        Minimum="-60"
                                        SnapsTo="StepValues"
                                        TickFrequency="15"
                                        TickPlacement="Outside"
                                        Value="{x:Bind ViewModel.Offset, Mode=TwoWay}" />
                                    <TextBlock
                                        x:Name="geoOffsetValue"
                                        Grid.Column="1"
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="{x:Bind ViewModel.Offset, Mode=OneWay}" />
                                </Grid>
                            </tkcontrols:SettingsCard>



                            <!--  Only show user selected times if SunsetToSunriseUser  -->
                            <tkcontrols:SettingsCard Header="Select location" Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=SunsetToSunriseUser}">
                                <StackPanel Orientation="Vertical" Spacing="8">
                                    <!--  Todo: City drop down  -->
                                    <ComboBox
                                        x:Name="CityComboBox"
                                        Width="250"
                                        DisplayMemberPath="Display"
                                        ItemsSource="{x:Bind ViewModel.Cities, Mode=OneWay}"
                                        PlaceholderText="Select city"
                                        SelectedItem="{x:Bind ViewModel.SelectedCity, Mode=TwoWay}" />
                                    <!--  Todo: Updated times from changing city  -->
                                    <TextBlock
                                        Margin="8,0,0,0"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="{x:Bind ViewModel.CityTimesText, Mode=OneWay}" />
                                    <!--  Todo: Option to add an offset  -->

                                </StackPanel>
                            </tkcontrols:SettingsCard>
                            <tkcontrols:SettingsCard Header="Apply an offset in minutes" Visibility="{x:Bind ViewModel.ScheduleMode, Mode=OneWay, Converter={StaticResource EnumToVisibilityConverter}, ConverterParameter=SunsetToSunriseUser}">
                                <Grid VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Slider
                                        x:Name="useroffsetSlider"
                                        Grid.Column="0"
                                        Maximum="60"
                                        Minimum="-60"
                                        SnapsTo="StepValues"
                                        TickFrequency="15"
                                        TickPlacement="Outside"
                                        Value="{x:Bind ViewModel.Offset, Mode=TwoWay}" />
                                    <TextBlock
                                        x:Name="userOffsetValue"
                                        Grid.Column="1"
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        FontSize="12"
                                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                        Text="{x:Bind ViewModel.Offset, Mode=OneWay}" />
                                </Grid>
                            </tkcontrols:SettingsCard>
                        </tkcontrols:SettingsExpander.Items>
                    </tkcontrols:SettingsExpander>
                    <tkcontrols:SettingsExpander
                        Description="Pick which parts of your PC should follow dark mode"
                        Header="Apply dark mode to"
                        HeaderIcon="{ui:FontIcon Glyph=&#xE790;}"
                        IsExpanded="True">
                        <tkcontrols:SettingsExpander.Items>
                            <tkcontrols:SettingsCard HorizontalContentAlignment="Stretch" ContentAlignment="Left">
                                <controls:CheckBoxWithDescriptionControl
                                    Description="Taskbar, Start, and other system UI"
                                    Header="System"
                                    IsChecked="{x:Bind ViewModel.ChangeSystem, Mode=TwoWay}" />
                            </tkcontrols:SettingsCard>
                            <tkcontrols:SettingsCard HorizontalContentAlignment="Stretch" ContentAlignment="Left">
                                <controls:CheckBoxWithDescriptionControl
                                    Description="Supported applications"
                                    Header="Apps"
                                    IsChecked="{x:Bind ViewModel.ChangeApps, Mode=TwoWay}" />
                            </tkcontrols:SettingsCard>
                        </tkcontrols:SettingsExpander.Items>
                    </tkcontrols:SettingsExpander>
                    <!--  Force mode buttons  -->
                    <!--<tkcontrols:SettingsCard
        Header="Force mode now"
        HeaderIcon="{ui:FontIcon Glyph=&#xE706;}"
        Description="Apply light or dark mode immediately">
            <StackPanel Orientation="Horizontal" Spacing="12">
              <Button
        Content="Force Light"
        Command="{x:Bind ViewModel.ForceLightCommand}" />
              <Button
        Content="Force Dark"
        Command="{x:Bind ViewModel.ForceDarkCommand}" />
            </StackPanel>
          </tkcontrols:SettingsCard>-->
                </controls:SettingsGroup>
            </StackPanel>
        </controls:SettingsPageControl.ModuleContent>

        <controls:SettingsPageControl.PrimaryLinks>
            <controls:PageLink x:Uid="LearnMore_DarkMode" Link="https://aka.ms/PowerToysOverview_ZoomIt" />
        </controls:SettingsPageControl.PrimaryLinks>
    </controls:SettingsPageControl>
</Page>
